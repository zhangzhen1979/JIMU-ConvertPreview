# 文件格式转换接口说明

生成JPG/PDF/OFD接口URL：[http://host:port/api/convert](http://host:port/api/convert)

接口调用方式：POST

传入参数形式：JSON

传入参数示例：

```json
{
  "inputType": "path",
  "inputFiles": [
    {
        "inputFile": "D:/cvtest/001.pdf",
        "inputFileType": "pdf"
    },
    {
        "inputFile": "D:/cvtest/002.pdf",
        "inputFileType": "pdf"
    }
  ],
  "inputAsAttach": true,
  "outPutFileName": "001-online",
  "outPutFileType": "jpg",
  "writeBackType": "path",
  "writeBack": {
    "path": "D:/cvtest/",
    "zip":{
        "hasExt": true,
        "password": "12345",
        "randompwd": false,
        "randompwdlen": 6
    }
  },
  "outEncry": {
    "username": "zhang3",
    "userPassword": "zhang3pwd",
    "ownerPassword": "ownerpwd",
    "copy": false,
    "modify": false,
    "print": false
  },
  "pageLimits": "2-7",
  "waterMark": {
    "pic": {
      "waterMarkFile": "watermark.png",
      "LocateX": "40",
      "LocateY": "10",
      "imageWidth": "50",
      "imageHeight": "50"
    },
    "text": {
      "waterMarkText": "办公室 普通用户\n192.168.1.1\n2022-10-14 12:01:01",
      "degree": "45",
      "fontName": "宋体",
      "fontSize": "20",
      "fontColor": "gray"
    },
    "alpha": "1f"
  },
  "firstPageMark": {
    "template": "gdz.html",
    "pngWidth": 810,
    "pngHeight": 250,
    "isCm": false,
    "locate": "TR",
    "data": {
      "tableWidth": "800px",
      "tdWidth": "200px",
      "tdHeight": "120px",
      "fontSize": "40px",
      "fonds_no": "1001",
      "year": "2001",
      "piece_no": "123",
      "department": "办公室",
      "retention": "长期",
      "page_amounts": "10"
    }
  },
  "cover": {
    "base64": "adffadsr2r234234234234234="
  },
  "attachments": [
    {
        "inputFile": "D:/cvtest/dataMeta.xml",
        "inputFileName": "dataMeta.xml",
        "inputFileType": "xml"
    },
    {
        "inputFile": "D:/cvtest/DAT48.xml",
        "inputFileName": "DAT48.xml",
        "inputFileType": "xml"
    },    {
        "inputFile": "D:/cvtest/DAT46.xml",
        "inputFileName": "DAT46.xml",
        "inputFileType": "xml"
    }
  ],
  "metaData": {
    "arcType": "financial",
    "configId": "inv_ord_receiver",
    "data": {………………}
  }
}
```

以下分块解释传入参数每部分的内容。

## 输入文件设置

### 输入文件方式

系统支持本地文件路径输入（path）、http协议的url文件下载输入（url）、ftp服务路径输入（ftp）、Base64编码字符串（base64）。可以传入各种文档格式，由系统转换为PDF/OFD；也可以直接传入PDF/OFD，由系统自动进行后续的添加水印、添加归档章的操作。

#### PATH

当使用文件路径输入时，配置示例如下：

```json
"inputType": "path",
"inputFile": "D:/cvtest/1.tiff",
"inputFileName": "1.tiff",
"inputFileType": "tiff",
"inputAsAttach": true,
```

- inputType：必填，值为“path”。
- inputFile：必填，值为需转换的图片文件（输入文件）在当前服务器中的路径和文件名。
- inputAsAttach：非必填，生成PDF/OFD文件时有效。输入的文件是否作为PDF/OFD文件的“附件”。

#### URL

当使用url文件下载输入时，配置示例如下：

```json
"inputType": "url",
"inputFile": "http://localhost/file/1.tiff",
"inputFileName": "1.tiff",
"inputFileType": "tiff",
"inputAsAttach": true,
```

- inputType：必填，值为“url”。
- inputFile：必填，值为需转换的文件（输入文件）在Web服务中的URL地址。
- inputFileName：非必填，文件名。此项有值，则按照此值为文件命名；此项无值，则自动生成UUID文件名。
- inputFileType：“inputType”为“url”时，必填。值为url链接的文件的扩展名。
- inputAsAttach：非必填，生成PDF/OFD文件时有效。输入的文件是否作为PDF/OFD文件的“附件”。

#### FTP

当使用ftp时，配置示例如下：

```json
"inputType": "ftp",
// 有密码配置
"inputFile": "ftp://ftptest:zx@192.168.0.102/archives/ftptest/tjTest/test.png",
"inputFileName": "test.png",
"inputFileType": "png",
// 无密码配置
// "inputFile":"ftp://192.168.0.102/archives/ftptest/tjTest/test.doc",
"inputAsAttach": true,
```

- inputType：必填，值为“ftp”。
- inputFile：必填，值为需转换的图片文件（输入文件）在FTP服务中的地址,兼容用户密码。
- inputAsAttach：非必填，生成PDF/OFD文件时有效。输入的文件是否作为PDF/OFD文件的“附件”。

#### BASE64

当使用base64方式输入时，配置示例如下：

```json
"inputType": "base64",
"inputFile": "data:application/pdf;base64,JKDE234234DFAdRFAFAWERQWERQW="
"inputFileName": "1.tiff",
"inputFileType": "tiff",
"inputAsAttach": true,
```

- inputType：必填，值为“base64”。
- inputFile：必填，值为文件转换后的Base64字符串（前端转换）。
- inputFileName：非必填，文件名。此项有值，则按照此值为文件命名；此项无值，则自动生成UUID文件名。
- inputFileType：必填，值为文件的扩展名。
- inputAsAttach：非必填，生成PDF/OFD文件时有效。输入的文件是否作为PDF/OFD文件的“附件”。

### 多文件合并

系统支持将多个JPG文件合并为一个PDF/OFD文件；或PDF文件合并为一个PDF文件；或多个OFD文件合并为一个OFD文件。

当使用文件路径输入时，配置示例如下：

```json
"inputType": "path",
"inputFiles": [
    {
        "inputFile": "D:/cvtest/001.pdf",
        "inputFileType": "pdf",
        "duplexPrint": true,
        "blankPageHaveNum": true
    },
    {
        "inputFile": "D:/cvtest/002.pdf",
        "inputFileType": "pdf"
    }
],
"inputAsAttach": true,
"outPutFileName": "001-online",
```

url、ftp方式配置内容与【输入信息】章节中说明一致。

系统会按照PDF文件传入的顺序，将其合并为一个新的PDF文件。

- inputType：必填，文件输入方式，path、url、ftp
- inputFiles：此场景下必填，输入的多个PDF文件路径。
  - inputFile：必填，值为需转换的文件（输入文件）路径或URL地址或ftp地址。
  - inputFileType：必填，值为文件的扩展名。
  - duplexPrint：非必填，true/false。默认值：false。如果此文件为单页，则在合并后的文件中补充空白页，使之符合双面打印要求（双页）。
  - blankPageHaveNum：非必填，true/false。默认值：false。如果此文件为单页，则在合并后的文件中补充空白页后，可以控制此空白页是否生成页码。
- inputAsAttach：非必填，输入的文件是否作为合并后PDF/OFD文件的“附件”。
- outPutFileName：必填，为文件生成后的文件名，扩展名自动为pdf/ofd。

### 【附件】设置

系统支持在转换后的PDF/OFD文件中添加【附件】，以满足将版式文件作为【文件包】使用的目的。

【附件】的定义方式与【输入文件】类似，以下参数均为必填。。

```json
  "attachments": [
    {
        "inputFile": "D:/cvtest/dataMeta.xml",
        "inputFileName": "dataMeta.xml",
        "inputFileType": "xml"
    },
    {
        "inputFile": "D:/cvtest/DAT48.xml",
        "inputFileName": "DAT48.xml",
        "inputFileType": "xml"
    },    {
        "inputFile": "D:/cvtest/DAT46.xml",
        "inputFileName": "DAT46.xml",
        "inputFileType": "xml"
    }
  ],
```

- inputFile：必填，值为文件转换后的Base64字符串（前端转换）。
- inputFileName：必填，文件名。此项有值，则按照此值为文件命名；此项无值，则自动生成UUID文件名。
- inputFileType：必填，值为文件的扩展名。

### 将输入文件作为【附件】

系统支持将输入文件作为转换后PDF/OFD文件的【附件】，此时需要使用如下参数。

```json
  "inputAsAttach": true,
```

### 【元数据】设置

系统支持解析传入的元数据JSON，并生成符合对应门类国家标准的XML元数据文件。

```json
  "metaData": {
    "arcType": "financial",
    "configId": "inv_ord_receiver",
    "data": {………………}
  }
```

- arcType：必填，档案类型。
  - 文书档案：archive
  - 会计档案：financial
- configId：必填，单据名称。
  - 文书档案：空，不用填写。
  - 会计档案：根据不同单据类型的标准名而定。
- data：必填，元数据JSON报文。

## 输出文件设置

### 输出文件设置

可以设置输出的Jpg/Pdf/Ofd文件的文件名（无扩展名）和输出的文件类型，如下：

```json
"outPutFileName": "001-online",
"outPutFileType": "pdf",
"outPutReadOnly": true,
```

- outPutFileName：必填，为文件生成后的文件名（无扩展名）。
- outPutFileType：必填，为文件生成后的扩展名。本服务支持：jpg、pdf、ofd
- outPutReadOnly：非必填。如果此项设置为True，则系统将文件转换为图片格式的PDF或OFD，转换后的文件即只读。主要用于“版式文件涂黑”使用。

本例中，即转换后生成名为 001-online.pdf 的文件。

### 文件加密设置

#### PDF加密设置

系统支持在转换的PDF文件中设置用户名和密码，并可控制PDF文件的使用权限。

（可选项，不设置则此项不传值即可）

示例如下：

```json
"outEncry": {
    "username": "zhang3",
    "userPassword": "zhang3pwd",
    "ownerPassword": "ownerpwd",
    "copy": false,
    "modify": false,
    "print": false,
    "assembleDocument": false,
    "fillInForm": false,
    "modifyAnnotations": false,
    "printDegraded": false,
    "export": false,
    "validPeriodStart": "2022-12-01",
    "validPeriodEnd": "2022-12-31"
},
```

- 
- username：用户名，必填。
- userPassword：用户密码（权限受控），必填。
- ownerPassword：拥有者密码（不控制权限），必填。
- copy：是否允许用户复制（权限受控），必填。默认值为true。
- modify：是否允许用户编辑（权限受控），必填。默认值为true。
- print：是否允许用户打印（权限受控），必填。默认值为true。
- assembleDocument：是否可以插入/删除/旋转页面，非必填。默认值为true。
- fillInForm：是否可以填写交互式表单字段（包括签名字段），非必填。默认值为true。
- modifyAnnotations：是否可以添加或修改文本注释并填写交互式表单字段，如果canModify()返回true，则创建或修改交互式表单字段（包括签名字段）。非必填。默认值为true。
- printDegraded：是否可以降级格式打印文档，非必填。默认值为true。
- export：是否允许导出，非必填。默认值为true。
- validPeriodStart：有效期开始日期，非必填。使用有效期设置时必填。
- validPeriodEnd：有效期结束日期，非必填。使用有效期设置时必填。

#### OFD加密设置

系统支持在转换的OFD文件中设置访问密码。建议使用“超越版式办公套件”浏览加密后的OFD（数科阅览器、WPS均不支持打开加密OFD）。

（可选项，不设置则此项不传值即可）

示例如下：

```json
"outEncry": {
    "username": "admin",
    "userPassword": "zhang3pwd",
    "copy": false,
    "modify": false,
    "print": false,
    "copies": 3,
    "signature": false,
    "watermark": false,
    "export": false,
    "modifyAnnotations": false,
    "validPeriodStart": "2022-12-01",
    "validPeriodEnd": "2022-12-31"
},
```

- username：用户名，非必填。设置密码后的html无法预览ofd内容，只能下载后使用【超越版式办公套件】查看。OFD文件建议传入固定值admin。如不传入此参数，则系统自动设置用户名为admin。
- userPassword：用户密码（权限受控），使用加密时必填。
- copy：是否允许用户复制（权限受控），必填。默认值为true。
- modify：是否允许用户编辑（权限受控），必填。默认值为true。
- print：是否允许用户打印（权限受控），必填。默认值为true。
- copies：允许打印的份数（允许打印时有效），非必填。
- signature：是否允许添加签章，非必填。默认值为true。
- watermark：是否允许添加水印，非必填。默认值为true。
- export：是否允许导出，非必填。默认值为true。
- modifyAnnotations：是否允许添加批注，非必填。默认值为true。
- validPeriodStart：有效期开始日期，非必填。使用有效期设置时必填。
- validPeriodEnd：有效期结束日期，非必填。使用有效期设置时必填。

### 输出文件页码范围

系统支持控制输出的PDF/OFD文件的页码范围（即只将指定页码的内容输出到转换的PDF/OFD中）。此种模式，只在“转换为JPG”、”图片转PDF“、“PDF转PDF”时生效。

```json
  "pageLimits": "2-7",
```

- pageLimits：非必填。可以设置页码范围，例如：“2-7”，则只将第2页至第7页输出到转换后的文件中；“2,4,7”，则只将第2、4、7页输出到转换后的文件中。

### 输出文件水印设置

#### 图片水印

系统支持在转换的JPG/PDF/OFD文件中加入图片水印或文字水印。

如果需要加入图片水印，设置如下：

```json
"waterMark": {
    "pic": {
        "waterMarkFile": "watermark.png",
        "LocateX":"10",
        "LocateY": "10",
        "imageWidth": "50",
        "imageHeight": "50"
    },
    "alpha": "1f"
},
```

- waterMarkFile：必填，为本服务“watermark”文件夹中已经存放的水印文件。建议使用png格式的文件（支持半透明）。
- LocateX：非必填，单位：毫米。水印中心点在文档中横轴的位置。默认值为宽度的1/6位置（左下角）。
- LocateY：非必填，单位：毫米。水印中心点在文档中纵轴的位置。默认值为高度的1/6位置（左下角）。
- imageWidth：非必填，单位：毫米。水印图片的宽度。默认值为50。
- imageHeight：非必填，单位：毫米。水印图片的高度。默认值为50。
- alpha：非必填，透明度，传入文件为PDF/OFD时有效。默认值“1f”。浮点小数，添加的值必须以“f”结尾。如果需要给PDF、OFD文件添加透明水印，则此处透明度设置为“0f”。

#### 文字水印

如果需要加入文字水印，设置如下：

```json
"waterMark": {
    "text": {
        "waterMarkText": "办公室 普通用户\n192.168.1.1\n2022-10-14 12:01:01",
        "degree": "45",
        "fontSize": "20",
        "fontColor": "gray"
    },
    "alpha": "1f"
},
```

- waterMarkText：必填，水印的文字内容。支持多行水印，使用“\n”分隔符。
- degree：必填，旋转角度。
- fontSize：非必填，字号大小。默认值40。
- fontColor：非必填，字体颜色。默认值“gray”（灰色）。
- alpha：非必填，透明度，传入文件为PDF/OFD时有效。默认值“1f”。浮点小数，添加的值必须以“f”结尾。如果需要给PDF、OFD文件添加透明水印，则此处透明度设置为“0f”。

#### 【页码】水印

参数设置如下：

```json
"waterMark": {
    "alpha": "1f",
    "pageNum": {
        "enable": true,
        "fontSize": 15,
        "fontColor": "black",
        "locate": "TR",
        "margins": 30,
        "swapPosition": false,
        "startNum": 10,
        "digits": 3
    }
}
```

- alpha：非必填，透明度，传入文件为PDF/OFD时有效。默认值“1f”。浮点小数，添加的值必须以“f”结尾。如果需要给PDF、OFD文件添加透明水印，则此处透明度设置为“0f”。
- pageNum：非必填，生成页码。
  - enable：开关。true为生成；false或不填写此项，则不生成。
  - fontSize：非必填，字号大小。默认值15。
  - fontColor：非必填，字体颜色。默认值“black”（黑色）。
  - locate：页码位置。如果不设置此项，或者留空，则默认位置为【顶部靠右】（TR）；如果设置位置值，则在指定位置添加页码。
    - TR：顶部靠右。Top Right。
    - TM：顶部居中。Top Middle。
    - TL：顶部靠左。Top Left。
    - CR：中心靠右。Center Right。
    - C：中心。Center
    - CL：中心靠左。Center Left。
    - BR：底部靠右。Bottom Right。
    - BM：底部居中。Bottom Middle。
    - BL：底部靠左。Bottom Left。
  - margins：非必填，页码边距。默认值30。因为尺寸单位不同，同样边距，PDF的值大约是OFD值的3倍。
  - swapPosition：非必填，奇偶页位置互换。默认为false。即【页码位置】中设置的是第1页（奇数页）的页码位置，后续偶数页的页码位置会转到对称位置。此设置对【页码位置】为：TM（顶部居中）、C（中心）、BM（底部居中）时无效。
  - startNum：非必填，起始页码值。传入此值后，文件第一页的页码值即为此值。
  - digits：非必填，自动补零位数。如果设置的位数不为0，则自动以0补足位数；如果设置的位数为0，则不对页码补0。

#### 【版权声明】水印

公共参数，设置如下：

```json
"waterMark": {
    "alpha": "1f",
    "copyRight": {
        "enable": true,
        "text": "仅供XX公司内部使用",
        "fontSize": 15,
        "fontColor": "black",
        "locate": "BR",
        "margins": 30,
        "swapPosition": false,
        "startNum": 10
    }
}
```

- alpha：非必填，透明度，传入文件为PDF/OFD时有效。默认值“1f”。浮点小数，添加的值必须以“f”结尾。如果需要给PDF、OFD文件添加透明水印，则此处透明度设置为“0f”。
- copyRight：非必填，生成【版权声明】信息。
  - enable：开关。true为生成；false或不填写此项，则不生成。
  - fontSize：非必填，字号大小。默认值15。
  - fontColor：非必填，字体颜色。默认值“black”（黑色）。
  - locate：页码位置。如果不设置此项，或者留空，则默认位置为【顶部靠右】（TR）；如果设置位置值，则在指定位置添加页码。
    - TR：顶部靠右。Top Right。
    - TM：顶部居中。Top Middle。
    - TL：顶部靠左。Top Left。
    - CR：中心靠右。Center Right。
    - C：中心。Center
    - CL：中心靠左。Center Left。
    - BR：底部靠右。Bottom Right。
    - BM：底部居中。Bottom Middle。
    - BL：底部靠左。Bottom Left。
  - margins：非必填，PDF页码边距。默认值30。因为尺寸单位不同，同样边距，PDF的值大约是OFD值的3倍。
  - swapPosition：非必填，奇偶页位置互换。默认为false。即【页码位置】中设置的是第1页（奇数页）的页码位置，后续偶数页的页码位置会转到对称位置。此设置对【页码位置】为：TM（顶部居中）、C（中心）、BM（底部居中）时无效。
  - startNum：非必填，起始页码值。传入此值后，文件第一页的页码值即为此值。

#### 首页水印（归档章）

可以设置输出的Jpg/Pdf/Ofd文件首页水印（归档章），如下：

- base64：可选项。此参数传入base64后的html模板的字符串。采用前端业务系统生成“归档章”HTML模板时，可使用此参数；如果使用转换服务内置的模板文件，则不需要传输此参数。参数传入示例如下：

```json
"firstPageMark": {
    "base64": "assdffafadsfadfadfadaf=",
    "pngWidth": 1.6,
    "pngHeight": 4.5,
    "isCm": true,
    "locate": "TR"
},
```

- template：生成归档章用的HTML模板文件名（文件存放于“watermark”文件夹中）。
- pngWidth：生成的png的宽度。此处设置的宽度需要略大于下面“data”中的“tableWidth”的值（给表格的边框留出空间）。
- pngHeight：生成的png的高度。此处设置的高度需要略大于下面“data”中的“tdHeight”值的 2 倍（给表格的边框留出空间）。
- isCm：是否为“厘米”单位。非必填，可无此key。默认值为false。当设置为true时，则设置的图片高度、宽度的单位均为“厘米”，否则为“像素”。
- locate：图片位置。如果不设置此项，或者留空，则默认位置为【顶部居中】（TM）；如果设置位置值，则在指定位置添加页码。
  - TR：顶部靠右。Top Right。
  - TM：顶部居中。Top Middle。
  - TL：顶部靠左。Top Left。
  - CR：中心靠右。Center Right。
  - C：中心。Center
  - CL：中心靠左。Center Left。
  - BR：底部靠右。Bottom Right。
  - BM：底部居中。Bottom Middle。
  - BL：底部靠左。Bottom Left。
- data：归档章中需要替换的字段和数据。【key：模板HTML中需要替换的字段名；value：模板HTML中需要替换的字段值。】（如果上述输入的水印尺寸为“厘米”，则此处设置模板时，需要将尺寸换算为“像素”以设置HTML中表格的宽高。公式如下：px=cm/ 2.54 * 400。本服务中，400是dpi的值）
  - tableWidth：表宽度。必须写单位px！此内容会替换模板中CSS的设置。
  - tdWidth：单元格宽度。必须写单位px！需要根据模板中每行单元格的个数，计算单个单元格的宽度。即，表宽度=单元格宽度*单元格个数。此内容会替换模板中CSS的设置。
  - tdHeight：单元格高度。必须写单位px！需要根据模板中行数，计算单个单元格的高度。即，单元格高度 = （pngHeight - 10 ）/ 行数。此内容会替换模板中CSS的设置。
  - fontSize：字体大小。必须写单位px！此内容会替换模板中CSS的设置。
  - fonds_no：全宗号。归档章内容。
  - year：归档年度。归档章内容。
  - piece_no：件号。归档章内容。
  - department：机构或问题。归档章内容。
  - retention：保管期限。归档章内容。
  - page_amounts：页数。归档章内容。

#### 二维码/条码

可以设置输出的Jpg/Pdf/Ofd文件加入“二维码/条码”水印，如下：

```json
"barcode": {
    "code": "QR_CODE",
    "context": "QZH-2022-ws-001-0123",
    "isFirstPage": true,
    "pngWidth": 1.6,
    "pngHeight": 4.5,
    "isCm": true,
    "locate": "TR"
},
```

- code：生成的条码或二维码的编码格式。支持如下编码：
  - 条码
    - CODABAR：支持 数字 和 - $ : / . + 一共16种符号，支持ABCD/EN*T 首尾。(类似A首E尾不支持,类似A首B尾支持)
    - CODE_39：支持大写英文字母，- . $ / + % 和 空格，额外支持 *，一共43种符号。
    - CODE_93：在Code_39的支持范围上增加了5种特殊符号，用以支持ASCII的128种符号。
    - CODE_128：【常用编码】支持ASCII的128种符号。(通过3套不同的编码表，编码中随时切换并写下标志位)
    - EAN：国际货物编码(International Article Number)，又称欧洲货物编码(European Article Number)仅支持数字，最后一位数字位校检。
    - EAN_8：8位编码，源自EAN_13。
    - EAN_13：13位编码。
    - UPC：Universal Product Code，通用货物编码，纯数字。
    - UPC_A：UPC-A技术上一般指代UPC，12位纯数字编码。首尾区外侧存在数字。
    - UPC_E：6位编码，数字在首尾区内侧。
    - RSS：全称 Reduced Space Symbology，现称 GS1 DataBar，因与RSS(Really Simple Syndication)易混淆，便改名。
    - RSS_14：仅支持纯数字编码。
    - RSS_EXPANDED：无相关资料。
    - ITF：全称 Interleaved Two of five, 交错式2或5条码。每5条里有2条粗条。纯数字编码，仅支持偶数位数编码，即xx，xxxx等。为提高识别度，会在条码外圈用粗线框包裹。
    - IMB：全称 Intelligent Mail Barcode，智能邮件条形码，纯数字编码，被美国邮件采用。
    - PLESSEY：仅支持数字， 和ABCDEF6个大写字母，一共16个符号。
    - PHARMA_CODE：仅支持存放3到131070范围的一个数(2^17-2)。一家制药企业用于其包装控制系统识别。
  - 二维码
    - AZTEC：支持ASCII的128种符号。因定位点在中心， 类似阿兹特克金字塔，故称为 阿兹特克码。
    - DATA_MATRIX：支持ASCII，及更多模式。左及下边缘全为黑色点位。
    - MAXICODE：支持ASCII，及更多模式。定位点在中心，为3同心圆重合。用于美国邮政业务(UPS)。
    - PDF_417：支持ASCII，最短26位。外观形似一维，但属于行堆叠，3到90行范围，高信息密度，常用于登机证。
    - QR_CODE：【常用编码】全称Quick Response Code， 快速响应码。除右下外共3个正方形定位点。
- context：编码中的文字内容（注意：不同的编码支持的字符集不同！）。
- pngWidth：生成的png的宽度。此处设置的宽度需要略大于下面“data”中的“tableWidth”的值（给表格的边框留出空间）。
- pngHeight：生成的png的高度。此处设置的高度需要略大于下面“data”中的“tdHeight”值的 2 倍（给表格的边框留出空间）。
- isFirstPage：是否只在首页输出。默认值为true；如果设置为flase，则每页都加入条码/二维码。
- isCm：是否为“厘米”单位。非必填，可无此key。默认值为false。当设置为true时，则设置的图片高度、宽度的单位均为“厘米”，否则为“像素”。
- locate：图片位置。如果不设置此项，或者留空，则默认位置为【顶部靠左】（TL）；如果设置位置值，则在指定位置添加页码。
  - TR：顶部靠右。Top Right。
  - TM：顶部居中。Top Middle。
  - TL：顶部靠左。Top Left。
  - CR：中心靠右。Center Right。
  - C：中心。Center
  - CL：中心靠左。Center Left。
  - BR：底部靠右。Bottom Right。
  - BM：底部居中。Bottom Middle。
  - BL：底部靠左。Bottom Left。

### 添加封面页

可以设置输出的Pdf/Ofd文件封面，示例报文如下：

```json
"cover": {
    "base64": "assdffafadsfadfadfadaf="
},
```

- base64：此参数传入base64后的，作为封面内容的html字符串。

### 生成缩略图

如果需要生成缩略图，则需要添加如下内容。（注意：使用【缩略图】设置后，【图片水印】、【文字水印】、【首页水印】、【双层PDF】等设置均失效。只生成缩略图。）

缩略图输出固定使用“jpg”格式。

设定缩略图边长：

```json
"thumbnail": {
    "width": 200,
    "height": 400
},
```

- width：非必填（width和height可只填其一，也可都填），缩略图的宽度像素值。不填写height值，则根据宽度自动按原比例计算高度。
- height：非必填（width和height可只填其一，也可都填），缩略图的高度像素值。不填写width值，则根据高度自动按原比例计算宽度。

或设定缩略图比例：

```json
"thumbnail": {
    "scale": 0.8,
    "quality": 0.9
},
```

- scale：必填，图片缩放比例。

- quality：必填，为缩略图压缩比。
  
  生成缩略图的完整输入示例如下：

```json
{
  "inputType": "path",
  "inputFile": "D:/cvtest/001.tif",
  "outPutFileName": "001-thumbnail",
  "thumbnail": {
    "width": 200,
    "height": 400
  },
  "writeBackType": "path",
  "writeBack": {
    "path": "D:/cvtest/"
  }
}
```

本例中，即转换后生成名为 001-thumbnail.jpg 的缩略图文件。

### 合成双层PDF

双层PDF，一种具有多层结构的PDF格式文件，上层是文字内容，下层是原始图像，是可以检索的PDF文件。

```json
"context": [
    {
        "pageIndex": 0,
        "text": "第一页内容",
        "rect": {
            "x": 185,
            "y": 78,
            "width": 238,
            "height": 24
        }
    },
    {
        "pageIndex": 1,
        "text": "第二页内容。。。",
        "rect": {
            "x": 204,
            "y": 109,
            "width": 199,
            "height": 25
        }
    }
]
```

- context: 非必填，仅在`outPutFileType=pdf`时有效，存在该项时标识生成双层PDF
- context.pageIndex: 识别结果页序号，从0开始
- context.text: 识别文本结果

## 输出文件回写设置

本服务支持以下回写方式：文件路径（path）、服务器端路径（local）、http协议上传（url）、FTP服务上传（ftp）、Ecology接口回写（ecology）。

注意：返回Base64接口无此部分回写信息。

#### PATH

当使用文件路径（path）方式回写时，配置如下：

```json
"writeBackType": "path",
"writeBack": {
    "path": "D:/data2pdf/",
    "zip":{
        "hasExt": true,
        "password": "12345",
        "randompwd": false,
        "randompwdlen": 6
    }
},
```

- writeBackType：必填，值为“path”。
- writeBack：必填。JSON对象，path方式中，key为“path”，value为MP4文件回写的路径。
- zip：非必填。zip压缩参数。如果设置此项，即为启用zip压缩，生成的报表文件会被压缩为zip包（文件名中是否包含扩展名，由【hasExt】参数控制。例如："zip": {}，空对象即可，即为启用zip压缩（无压缩密码）。
  - hasExt： 非必填。生成的zip文件是否需要扩展名。默认值：true。如果设置为false，则生成的文件只有文件名，没有zip扩展名。
  - password：非必填。zip文件密码。如果传入此值，则将输入的值作为生成zip文件的压缩密码。
  - randompwd：非必填。是否自动生成zip文件密码。默认false。如果设置为true，则系统自动随机生成密码，并通过【回调接口】回写密码。
  - randompwdlen：非必填。自动密码长度。【randompwd】设置为true时，此项有效。

#### LOCAL

当使用服务器端路径（local）方式回写时，配置如下：

```json
"writeBackType": "local",
```

- writeBackType：必填，值为“local”。此时，系统自动获取配置文件中【convert.path.outPutPath】设置的路径，将转换后的文件存储在“输出文件夹”中；以待前端系统下载。前端系统访问本服务的“/outfile/文件名”url即可下载。例如：http://127.0.0.1:8080/outfile/cs-alpha0.pdf

#### URL

当使用http协议上传（url）方式回写时，配置如下：

```json
"writeBackType": "url",
"writeBack": {
    "url": "http://localhost/uploadfile.do",
    "zip":{
        "hasExt": true,
        "password": "12345",
        "randompwd": false,
        "randompwdlen": 6
    }
},
"writeBackHeaders": {
    "token": "da3efcbf-0845-4fe3-8aba-ee040be542c0"
},
```

- writeBackType：必填，值为“url”。
- writeBack：必填。JSON对象，url方式中，key为“url”，value为业务系统提供的文件上传接口API地址。
- writeBackHeaders：非必填。如果Web服务器访问时需要设置请求头或Token认证，则需要在此处设置请求头的内容；否则此处可不添加。
- zip：非必填。zip压缩参数。同上。

#### FTP

当使用FTP服务上传（ftp）方式回写时，配置如下：

```json
"writeBackType": "ftp",
"writeBack": {
    "passive": "false",
    "host": "ftp://localhost",
    "port": "21",
    "username": "guest",
    "password": "guest",
    "filepath": "/2021/10/",
    "zip":{
        "hasExt": true,
        "password": "12345",
        "randompwd": false,
        "randompwdlen": 6
    }
},
```

- writeBackType：必填，值为“ftp”。
- writeBack：必填。JSON对象。
  - passive：是否是被动模式。true/false
  - host：ftp服务的访问地址。
  - port：ftp服务的访问端口。
  - username：ftp服务的用户名。
  - password：ftp服务的密码。
  - filepath：文件所在的路径。
- zip：非必填。zip压缩参数。同上。

#### SFTP

当使用SFTP服务上传（sftp）方式回写时，配置如下：

```json
"writeBackType": "sftp",
"writeBack": {
    "host": "123.12.12.12",
    "port": "22",
    "username": "guest",
    "password": "guest",
    "filepath": "/home/data/2021/10/",
    "zip":{
        "hasExt": true,
        "password": "12345",
        "randompwd": false,
        "randompwdlen": 6
    }
},
```

- writeBackType：必填，值为“sftp”。
- writeBack：必填。JSON对象。
  - host：sftp服务的访问地址（IP或域名）。
  - port：sftp服务的访问端口。
  - username：sftp服务的用户名。
  - password：sftp服务的密码。
  - filepath：文件所在的路径（全路径）。
- zip：非必填。zip压缩参数。同上。

#### Ecology

当使用Ecology接口（ecology）方式回写时，配置如下：

```json
"writeBackType": "ecology",
"writeBack": {
    "address": "http://10.115.92.26",
    "api": "/api/doc/upload/uploadFile2Doc",
    "category": "123",
    "appId": "EEAA5436-7577-4BE0-8C6C-89E9D88805EA"
}
```

- writeBackType：必填，值为“ecology”。
- writeBack：必填。JSON对象。
  - address：ecology服务的访问地址
  - api：文件上传接口的api地址
  - category：Ecology中存储此类文件的“文档目录”的ID
  - appId: ecology系统发放的授权许可证(appid)

## 回调接口设置

业务系统可以提供一个GET方式的回调接口，在视频文件转换、回写完毕后，本服务可以调用此接口，传回处理的状态。

注意：返回Base64接口无此部分信息。

```json
"callBackURL": "http://10.11.12.13/callback.do",
"callBackHeaders": {
    "token": "da3efcbf-0845-4fe3-8aba-ee040be542c0"
},
```

- callBackURL：回调接口的URL。回调接口需要接收两个参数：
  - file：处理后的文件名。本例为“001-online.pdf”（如果使用ecology方式回写，则此处回传上传接口返回的id）。
  - flag：处理后的状态，值为：success 或 error。
  - pageNum：转换后文件的页数。
- callBackHeaders：如果回调接口需要在请求头中加入认证信息等，可以在此处设置请求头的参数和值。

接口url示例：

```
http://10.11.12.13/callback.do?file=001-online.pdf&flag=success
```

## 返回报文

接口返回信息示例如下：

```json
{
  "flag": "success",
  "message": "Convert Pic to JPG/PDF/OFD success."
}
```

- flag：处理状态。success，成功；error，错误，失败。
- message：返回接口消息。

# 临时文件删除接口说明

生成JPG/PDF/OFD接口URL：[http://host:port/api/deleteTempfile](http://host:port/api/deleteTempfile)

接口调用方式：POST

传入参数形式：JSON

传入参数示例：

```json
{
    "file": "1234.pdf"
}
```

- file：需删除的临时文件的文件名。

接口返回信息示例如下：

```json
{
  "flag": "success",
  "message": "临时文件【1234.pdf】删除成功"
}
```

- flag：处理状态。success，成功；error，错误，失败。
- message：返回接口消息。
